import React, { useState, useMemo } from 'react';
import { 
  Building2, 
  Search, 
  TrendingUp, 
  TrendingDown, 
  Users, 
  DollarSign, 
  Activity, 
  Cpu, 
  CreditCard, 
  Server, 
  Lightbulb, 
  CheckCircle2, 
  User,
  Layers,
  Clock,
  ShieldCheck,
  GraduationCap,
  AlertCircle,
  BarChart3,
  ExternalLink,
  ChevronRight,
  Target,
  Rocket
} from 'lucide-react';

const App = () => {
  const [searchTerm, setSearchTerm] = useState('');
  const [activeTab, setActiveTab] = useState('all');

  // --- Data ---
  const subsidiariesData = [
    { 
      id: 1, 
      name: 'پرداخت الکترونیک سپهر', 
      shortName: 'سپهر (PAS)',
      sector: 'پرداخت الکترونیک (PSP)', 
      revenue: 1710, 
      profit: 175, 
      employees: 1012, 
      targetAchievement: 85,
      status: 'active',
      improvements: [
        'ارتقای رتبه در سهم تراکنش‌های بانک صادرات',
        'ارتقای رتبه در ارزیابی ماهانه شاپرک'
      ],
      ceoName: 'احمد پیشگاه زاده',
      icon: <CreditCard size={24} />,
      gradient: 'from-blue-500 to-indigo-600',
      shadow: 'shadow-blue-200'
    },
    { 
      id: 2, 
      name: 'توسعه فناوری اطلاعات خوارزمی', 
      shortName: 'مفاخر',
      sector: 'زیرساخت و سخت‌افزار', 
      revenue: 184, 
      profit: 11, 
      employees: 450, 
      targetAchievement: 72,
      status: 'active',
      improvements: [
        'قرارداد خرید POS',
        'بهبود شاخص خدمات شعب'
      ],
      ceoName: 'محمدحسین خروطی',
      icon: <Server size={24} />,
      gradient: 'from-emerald-500 to-teal-600',
      shadow: 'shadow-emerald-200'
    },
    { 
      id: 3, 
      name: 'داده‌پردازی خوارزمی', 
      shortName: 'داده‌پردازی',
      sector: 'نرم‌افزار بانکی', 
      revenue: 134.5, 
      profit: 45, 
      employees: 160, 
      targetAchievement: 91,
      status: 'active',
      improvements: [
        { text: 'حل چالش‌های سیستم HR', urgent: true }
      ],
      ceoName: 'آرمین جعفری',
      icon: <Cpu size={24} />,
      gradient: 'from-amber-500 to-orange-600',
      shadow: 'shadow-amber-200'
    },
    { 
      id: 4, 
      name: 'گسترش انفورماتیک ایران', 
      shortName: 'گسترش',
      sector: 'آموزش و ترویج', 
      revenue: 3.4, 
      profit: -2.3, 
      employees: 28, 
      targetAchievement: 40,
      status: 'active',
      improvements: ['توقف فعالیت آموزش عالی'],
      ceoName: 'آقای عطاری',
      icon: <GraduationCap size={24} />,
      gradient: 'from-slate-500 to-slate-700',
      shadow: 'shadow-slate-200'
    },
    { 
      id: 5, 
      name: 'فناوری و راه‌حل‌های هوشمند سپهر', 
      shortName: 'هوشمند سپهر',
      sector: 'بانکداری دیجیتال', 
      revenue: 78, 
      profit: 30, 
      employees: 91, 
      targetAchievement: 88,
      status: 'active',
      improvements: ['حل مشکل فعال شدن رمز دوم در سپینو'],
      ceoName: 'حمید ارجمندی',
      icon: <Activity size={24} />,
      gradient: 'from-violet-500 to-purple-600',
      shadow: 'shadow-purple-200'
    },
    { 
      id: 6, 
      name: 'پیشگامان فناوری‌های نوین صاد', 
      shortName: 'پیشگامان',
      sector: 'نوآوری و کسب‌وکار', 
      revenue: 30, 
      profit: 1.4, 
      employees: 51, 
      targetAchievement: 95,
      status: 'active',
      improvements: ['مرکز تماس', 'پرتال جدید بانک صادرات'],
      ceoName: 'آقای هرمزی',
      icon: <Lightbulb size={24} />,
      gradient: 'from-rose-500 to-pink-600',
      shadow: 'shadow-rose-200'
    },
    { 
      id: 7, 
      name: 'داده و هوش مصنوعی الگوریتم', 
      shortName: 'الگوریتم',
      sector: 'هوش مصنوعی و داده', 
      revenue: 26.1, 
      profit: 0.23, 
      employees: 14, 
      targetAchievement: 65,
      status: 'active',
      improvements: ['قرارداد با دیبارایان'],
      ceoName: 'حمید کریمی',
      icon: <Target size={24} />,
      gradient: 'from-cyan-500 to-blue-600',
      shadow: 'shadow-cyan-200'
    },
    { 
      id: 8, 
      name: 'مدیریت راهبری و زیرساخت صاد', 
      shortName: 'زیرساخت صاد',
      sector: 'امنیت و شبکه', 
      revenue: 31, 
      profit: 4.5, 
      employees: 21, 
      targetAchievement: 78,
      status: 'active',
      improvements: ['ارائه پروپوزال برون‌سپاری خدمات هلدینگ'],
      ceoName: 'سعید جمالی',
      icon: <ShieldCheck size={24} />,
      gradient: 'from-red-500 to-rose-700',
      shadow: 'shadow-red-200'
    },
    { 
      id: 9, 
      name: 'توسعه فناوری اطلاعات هوشمند ماد', 
      shortName: 'ماد',
      sector: 'فناوری‌های نوین', 
      revenue: 0, 
      profit: 0, 
      employees: 5, 
      targetAchievement: 10,
      status: 'founding',
      improvements: ['آموزش و نوآوری'],
      ceoName: 'در حال تعیین',
      icon: <Rocket size={24} />,
      gradient: 'from-gray-400 to-gray-600',
      shadow: 'shadow-gray-200'
    },
  ];

  const filteredCompanies = useMemo(() => 
    subsidiariesData.filter(c => c.name.includes(searchTerm) || c.sector.includes(searchTerm)),
    [searchTerm]
  );

  return (
    <div className="min-h-screen bg-[#F0F4F8] text-slate-800 p-4 md:p-8 font-sans transition-all duration-500" dir="rtl">
      <div className="max-w-7xl mx-auto">
        
        {/* Animated Top Header */}
        <header className="flex flex-col items-center mb-12">
            <div className="relative group mb-6">
                <div className="absolute -inset-1 bg-gradient-to-r from-blue-600 to-indigo-600 rounded-full blur opacity-25 group-hover:opacity-50 transition duration-1000"></div>
                <img 
                  src="https://saad-holding.ir/wp-content/uploads/2023/12/logo-sad-holding.png" 
                  alt="Holding Logo" 
                  className="relative h-20 md:h-24 object-contain transition-transform duration-500 group-hover:scale-105"
                  onError={(e) => { e.target.src = "https://saad-holding.ir/wp-content/themes/saad-holding/assets/images/logo.png"; }}
                />
            </div>
            <div className="text-center">
                <h1 className="text-3xl md:text-4xl font-black bg-gradient-to-r from-blue-900 to-indigo-700 bg-clip-text text-transparent">اکوسیستم فناوری هوشمند صاد</h1>
                <p className="text-slate-500 mt-2 font-medium flex items-center justify-center gap-2">
                    <Activity size={16} className="text-blue-500 animate-pulse" />
                    پایش لحظه‌ای عملکرد و اهداف استراتژیک شرکت‌ها
                </p>
            </div>
        </header>

        {/* Global Controls & Search */}
        <div className="flex flex-col md:flex-row gap-4 mb-10 items-center justify-between bg-white/50 backdrop-blur-md p-4 rounded-3xl border border-white/50 shadow-xl shadow-slate-200/50">
            <div className="flex gap-2 p-1 bg-slate-100 rounded-2xl w-full md:w-auto">
                {['all', 'active', 'founding'].map((tab) => (
                    <button 
                        key={tab}
                        onClick={() => setActiveTab(tab)}
                        className={`px-6 py-2 rounded-xl text-xs font-black transition-all ${activeTab === tab ? 'bg-white shadow-md text-blue-600' : 'text-slate-500 hover:text-slate-800'}`}
                    >
                        {tab === 'all' ? 'همه واحدها' : tab === 'active' ? 'فعال' : 'در حال تأسیس'}
                    </button>
                ))}
            </div>
            <div className="relative w-full md:w-96">
                <Search className="absolute right-4 top-1/2 -translate-y-1/2 text-slate-400" size={20} />
                <input 
                    type="text" 
                    placeholder="جستجو در نام، مدیر یا حوزه فعالیت..." 
                    className="w-full bg-white border-none rounded-2xl pr-12 pl-4 py-3 text-sm shadow-inner ring-1 ring-slate-200 focus:ring-2 focus:ring-blue-500 outline-none transition-all"
                    value={searchTerm}
                    onChange={(e) => setSearchTerm(e.target.value)}
                />
            </div>
        </div>

        {/* Companies Grid */}
        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
          {filteredCompanies
            .filter(c => activeTab === 'all' || c.status === activeTab)
            .map((company) => (
            <div 
              key={company.id} 
              className={`relative bg-white rounded-[2.5rem] border-t-8 transition-all duration-500 flex flex-col group hover:-translate-y-3 hover:shadow-2xl overflow-hidden ${
                company.status === 'founding' ? 'border-gray-400 shadow-sm' : `border-transparent ${company.shadow}`
              }`}
              style={{ borderTopColor: company.status === 'founding' ? '#94a3b8' : 'transparent' }}
            >
              {/* Background Gradient Accent for Active Cards */}
              {company.status !== 'founding' && (
                <div className={`absolute top-0 inset-x-0 h-32 bg-gradient-to-br ${company.gradient} opacity-[0.03] group-hover:opacity-10 transition-opacity`}></div>
              )}

              {/* Card Header & Dynamic Icon */}
              <div className="p-8 pb-4 relative">
                <div className="flex justify-between items-start mb-6">
                  <div className={`w-16 h-16 rounded-[1.5rem] flex items-center justify-center text-white shadow-lg transform transition-transform group-hover:rotate-12 group-hover:scale-110 bg-gradient-to-br ${company.gradient}`}>
                    {company.icon}
                  </div>
                  
                  {/* Achievement Mini-Chart */}
                  <div className="relative w-14 h-14 flex items-center justify-center">
                    <svg className="w-full h-full transform -rotate-90">
                        <circle cx="28" cy="28" r="24" stroke="currentColor" strokeWidth="4" fill="transparent" className="text-slate-100" />
                        <circle 
                            cx="28" cy="28" r="24" stroke="currentColor" strokeWidth="4" fill="transparent" 
                            strokeDasharray={150}
                            strokeDashoffset={150 - (150 * company.targetAchievement) / 100}
                            className={`${company.status === 'founding' ? 'text-gray-400' : 'text-blue-500'} transition-all duration-1000 ease-out`}
                        />
                    </svg>
                    <span className="absolute text-[10px] font-black text-slate-800">{company.targetAchievement}%</span>
                  </div>
                </div>

                <h3 className="text-lg font-black text-slate-800 group-hover:text-blue-700 transition-colors">{company.name}</h3>
                <p className="text-[10px] text-slate-400 font-bold uppercase tracking-wider mt-1">{company.sector}</p>
              </div>

              {/* Improvements Section with Graphic Elements */}
              <div className="px-8 py-4 mb-2">
                <div className="bg-slate-50 rounded-2xl p-4 border border-slate-100 group-hover:bg-white group-hover:border-blue-100 transition-all">
                    <div className="flex items-center gap-2 mb-3">
                        <div className="p-1 rounded bg-amber-100 text-amber-600">
                            <AlertCircle size={12} />
                        </div>
                        <span className="text-[10px] font-black text-slate-500 uppercase">اولویت‌های بهبود</span>
                    </div>
                    <ul className="space-y-2">
                        {company.improvements.map((imp, idx) => {
                            const isUrgent = typeof imp === 'object' && imp.urgent;
                            const text = typeof imp === 'object' ? imp.text : imp;
                            return (
                                <li key={idx} className={`flex items-start gap-2 text-[11px] leading-relaxed ${isUrgent ? 'text-rose-600 font-black' : 'text-slate-600'}`}>
                                    <div className={`mt-1.5 w-1.5 h-1.5 rounded-full shrink-0 ${isUrgent ? 'bg-rose-600 animate-pulse' : 'bg-blue-400'}`}></div>
                                    {text}
                                </li>
                            );
                        })}
                    </ul>
                </div>
              </div>

              {/* Data Visuals */}
              <div className="px-8 grid grid-cols-3 gap-3 mb-6">
                <div className="text-center group/stat">
                    <p className="text-[9px] font-bold text-slate-400 mb-1">درآمد (همت)</p>
                    <div className="bg-slate-50 rounded-xl py-2 group-hover/stat:bg-blue-50 transition-colors font-black text-sm text-slate-800">
                        {company.revenue || '---'}
                    </div>
                </div>
                <div className="text-center group/stat">
                    <p className="text-[9px] font-bold text-slate-400 mb-1">سود (میلیارد)</p>
                    <div className="bg-slate-50 rounded-xl py-2 group-hover/stat:bg-emerald-50 transition-colors font-black text-sm text-emerald-600">
                        {company.profit || '---'}
                    </div>
                </div>
                <div className="text-center group/stat">
                    <p className="text-[9px] font-bold text-slate-400 mb-1">پرسنل (نفر)</p>
                    <div className="bg-slate-50 rounded-xl py-2 group-hover/stat:bg-violet-50 transition-colors font-black text-sm text-blue-600">
                        {company.employees}
                    </div>
                </div>
              </div>

              {/* Footer Controls */}
              <div className="mt-auto px-6 py-5 bg-slate-50/80 border-t border-slate-100 flex items-center justify-between">
                <div className="flex items-center gap-2">
                  <div className="w-8 h-8 rounded-full border-2 border-white shadow-sm overflow-hidden bg-white flex items-center justify-center">
                    <User size={16} className="text-slate-300" />
                  </div>
                  <div>
                    <p className="text-[7px] text-slate-400 font-bold uppercase leading-none">مدیر عامل</p>
                    <p className="text-[10px] font-black text-slate-700">{company.ceoName}</p>
                  </div>
                </div>
                <div className="flex gap-2">
                    <button className="p-2 rounded-lg bg-white shadow-sm border border-slate-200 text-slate-400 hover:text-blue-600 hover:border-blue-200 transition-all">
                        <BarChart3 size={16} />
                    </button>
                    <button className="px-3 py-2 rounded-lg bg-white shadow-sm border border-slate-200 text-slate-600 hover:bg-blue-600 hover:text-white transition-all text-[10px] font-black flex items-center gap-1">
                        جزئیات <ChevronRight size={12} />
                    </button>
                </div>
              </div>

              {/* Founding Overlay Effect */}
              {company.status === 'founding' && (
                <div className="absolute top-4 left-4">
                  <span className="flex items-center gap-1.5 bg-amber-100 text-amber-700 text-[9px] font-black px-3 py-1 rounded-full border border-amber-200 animate-bounce">
                    <Clock size={10} /> در حال تأسیس
                  </span>
                </div>
              )}
            </div>
          ))}
        </div>

        {/* Floating Summary Bar */}
        <div className="fixed bottom-6 left-1/2 -translate-x-1/2 bg-slate-900/90 backdrop-blur-xl text-white px-8 py-4 rounded-3xl shadow-2xl flex items-center gap-12 z-50 border border-white/10 hidden md:flex">
            <div className="flex items-center gap-3">
                <div className="p-2 bg-blue-500 rounded-lg"><DollarSign size={20}/></div>
                <div>
                    <p className="text-[10px] text-slate-400 font-bold">ارزش کل پورتفو</p>
                    <p className="text-sm font-black text-blue-400">2,225.1 همت</p>
                </div>
            </div>
            <div className="w-px h-8 bg-white/10"></div>
            <div className="flex items-center gap-3">
                <div className="p-2 bg-emerald-500 rounded-lg"><CheckCircle2 size={20}/></div>
                <div>
                    <p className="text-[10px] text-slate-400 font-bold">پروژه‌های استراتژیک</p>
                    <p className="text-sm font-black text-emerald-400">۴۲ فعال</p>
                </div>
            </div>
            <div className="w-px h-8 bg-white/10"></div>
            <div className="flex items-center gap-3">
                <div className="p-2 bg-purple-500 rounded-lg"><Layers size={20}/></div>
                <div>
                    <p className="text-[10px] text-slate-400 font-bold">واحدهای تابعه</p>
                    <p className="text-sm font-black text-purple-400">۹ شرکت</p>
                </div>
            </div>
        </div>

      </div>

      <style>{`
        @import url('https://cdn.jsdelivr.net/gh/rastikerdar/vazirmatn@v33.003/Vazirmatn-font-face.css');
        body { font-family: 'Vazirmatn', sans-serif; background-color: #F0F4F8; }
        .font-black { font-weight: 900; }
        @keyframes pulse-fast {
          0%, 100% { opacity: 1; transform: scale(1); }
          50% { opacity: 0.5; transform: scale(1.5); }
        }
      `}</style>
    </div>
  );
};

export default App;

